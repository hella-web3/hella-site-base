<!-- Global site tag (gtag.js) - Google Analytics with Do Not Track support -->
<script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="fe011b35-9177-4947-b0c2-e73b66c3b222" type="text/javascript"></script>
<script data-cookieconsent="ignore">
  (function(){
    if (typeof window === 'undefined' || typeof document === 'undefined' || typeof navigator === 'undefined') { return; }

    var dnt = navigator.doNotTrack == '1' || window.doNotTrack == '1' || navigator.msDoNotTrack == '1';

      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      window.gtag = gtag;

      gtag("consent", "default", {
          ad_storage: "denied",
          ad_user_data: "denied",
          ad_personalization: "denied",
          analytics_storage: "denied",
          functionality_storage: "denied",
          personalization_storage: "denied",
          security_storage: "denied",
          wait_for_update: 500,
      });

      console.log("Default consent set");
      console.log(dataLayer);

      var gaId;
      if (dnt) {
          gaId = '{{ site.data.settings.google_analytics_dnt }}';
      }
      else {
          gaId = '{{ site.data.settings.google_analytics }}';
      }
      if (!gaId) { return; }

      gtag('js', new Date());
      gtag('config', gaId, { anonymize_ip: true });

      gtag("set", "ads_data_redaction", true);
      gtag("set", "url_passthrough", false);



      Cookiebot.getScript('https://consent.cookiebot.com/fe011b35-9177-4947-b0c2-e73b66c3b222/cd.js', true,

          function(err, script) {
                console.log("Dialog Displayed");
          }
      )

      window.addEventListener('CookiebotOnAccept', function (e) {
          console.log(Cookiebot.consent.marketing);
              console.log("CookiebotOnAccept");

              gtag("consent", "update", {
                  ad_storage: "granted",
                  ad_user_data: "granted",
                  ad_personalization: "granted",
                  analytics_storage: "granted",
                  functionality_storage: "granted",
                  personalization_storage: "granted",
                  security_storage: "granted"
              });

      }, false);

      function CookiebotCallback_OnAccept() {

          console.log("CookiebotCallback_OnAccept");
      }


    const s = document.createElement('script');
    s.async = true;
    s.src = 'https://www.googletagmanager.com/gtag/js?id=' + gaId;
    s.onload = function(){



    };
    document.head.appendChild(s);

  })();
</script>
